<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€ ICARUS COMPLETE - Advanced Crafting Calculator</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.4/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 30%, #16213e 100%);
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .app-title {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #00d4ff 0%, #ff6b6b 50%, #4ecdc4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .app-subtitle {
            font-size: 1.2rem;
            color: #b0b3b8;
            font-weight: 500;
        }

        .stats-header {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 50vh;
            gap: 20px;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-left: 4px solid #00d4ff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: #00d4ff;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .loading-details {
            color: #b0b3b8;
            font-size: 0.9rem;
        }

        .error-screen {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: #ff6b6b;
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .error-message {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .retry-button {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .retry-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            align-items: start;
        }

        .content-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            min-height: 600px;
        }

        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: rgba(0,0,0,0.3);
            padding: 5px;
            border-radius: 15px;
        }

        .tab-button {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: #b0b3b8;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        .tab-button:hover:not(.active) {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .search-controls {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .search-input, .filter-select {
            padding: 12px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            outline: none;
        }

        .search-input::placeholder {
            color: #b0b3b8;
        }

        .filter-select option {
            background: #1a1a2e;
            color: white;
        }

        .map-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .map-label {
            color: #b0b3b8;
            font-weight: 600;
            margin-right: 10px;
        }

        .map-btn {
            padding: 10px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            font-weight: 600;
        }

        .map-btn.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            border-color: #ff6b6b;
            transform: translateY(-1px);
        }

        .map-btn:hover:not(.active) {
            background: rgba(255,255,255,0.2);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding: 10px;
            padding-right: 15px;
        }

        .items-grid::-webkit-scrollbar {
            width: 8px;
        }

        .items-grid::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .items-grid::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        .item-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.04) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .item-card:hover {
            background: linear-gradient(135deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0.08) 100%);
            border-color: rgba(0, 212, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.15);
        }

        .item-card.selected {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.3) 0%, rgba(0, 212, 255, 0.15) 100%);
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        .item-card.unavailable {
            opacity: 0.6;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(255, 107, 107, 0.1) 100%);
            border-color: rgba(255, 107, 107, 0.4);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .item-name {
            font-weight: 700;
            font-size: 13px;
            color: #ffffff;
            flex: 1;
            line-height: 1.3;
            margin-bottom: 4px;
        }

        .item-category {
            font-size: 11px;
            color: #b0b3b8;
            margin-bottom: 8px;
        }

        .availability-indicator {
            font-size: 16px;
            margin-left: 8px;
            flex-shrink: 0;
        }

        .item-details {
            display: flex;
            gap: 8px;
            align-items: center;
            font-size: 11px;
            margin-top: auto;
        }

        .tier-badge {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 10px;
        }

        .crafted-location {
            color: #b0b3b8;
            font-size: 10px;
            flex: 1;
            text-align: right;
        }

        .shopping-cart {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 700px;
            overflow-y: auto;
        }

        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .cart-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #ffffff;
        }

        .cart-count {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
        }

        .cart-items {
            min-height: 200px;
        }

        .cart-empty {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            font-style: italic;
        }

        .cart-item {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            background: rgba(255,255,255,0.12);
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 2px;
            font-size: 13px;
        }

        .cart-item-details {
            font-size: 11px;
            color: #b0b3b8;
        }

        .cart-item-quantity {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 12px;
            margin: 0 10px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.primary {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: white;
        }

        .btn.secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn.remove {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            min-width: auto;
            padding: 4px 8px;
            font-size: 12px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .results-panel {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .results-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #00d4ff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .resource-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .resource-item:last-child {
            border-bottom: none;
        }

        .resource-name {
            color: #ffffff;
            font-weight: 500;
            font-size: 13px;
        }

        .resource-amount {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 12px;
        }

        .success-banner {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: 600;
            text-align: center;
        }

        .map-info {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
        }

        .map-info h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .map-info p {
            color: #b0b3b8;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .resource-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 15px;
        }

        .resource-badge {
            background: rgba(255,255,255,0.1);
            padding: 6px 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 11px;
            color: #ffffff;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .stats-panel {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            font-size: 12px;
            color: #b0b3b8;
        }

        .stats-panel div {
            margin-bottom: 5px;
        }

        .stats-panel div:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .search-controls {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .action-buttons {
                flex-direction: column;
            }

            .items-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-screen">
            <div class="loading-spinner"></div>
            <div class="loading-text">ðŸš€ Loading ICARUS Complete...</div>
            <div class="loading-details">Initializing calculator...</div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // List of JSON files to attempt loading from icarus_data directory
        const JSON_FILES = [
            'ammunition.json',
            'armor.json',
            'building.json',
            'consumables.json',
            'cooking.json',
            'decoration.json',
            'deployables.json',
            'electricity_sources.json',
            'farming.json',
            'fuel_sources.json',
            'furniture.json',
            'inventory.json',
            'light_sources.json',
            'materials.json',
            'medicine.json',
            'raw_materials.json',
            'specialized_equipment.json',
            'storage.json',
            'tools.json',
            'water_sources.json',
            'weapons.json'
        ];

        // Map resource availability - COMPREHENSIVE MAPPING
        const MAP_RESOURCES = {
            "Olympus": [
                "Stone", "Wood", "Stick", "Sticks", "Fiber", "Leather", "Fur", "Bone", "Clay", "Ice", "Water",
                "Coal", "Oxite", "Sulfur", "Silica", "Tree Sap", "Carbon Paste", "Salt",
                "Iron Ore", "Copper Ore", "Gold Ore", "Aluminum Ore", "Platinum Ore", "Titanium Ore",
                "Exotics", "Exotic Matter", "Frozen Ore",
                "Iron Ingot", "Steel Ingot", "Steel Bloom", "Aluminum Ingot", "Copper Ingot", 
                "Platinum Ingot", "Titanium Ingot", "Refined Gold", "Steel Screw", "Copper Wire",
                "Gold Wire", "Electronics", "Carbon Fiber", "Composites", "Epoxy", "Organic Resin",
                "Concrete Mix", "Glass", "Rope", "Wool", "Charcoal", "Biofuel Can", "Iron Nail", "Copper Nail",
                "Brown Bear Fur", "Brown Bear Leather", "Brown Bear Bone",
                "Wolf Fur", "Wolf Leather", "Wolf Bone",
                "Deer Fur", "Deer Leather", "Deer Bone",
                "Mammoth Tusk", "Caveworm Chitin",
                "Pumpkin", "Corn", "Wheat", "Carrot", "Potato", "Tomato", "Beans", "Berry", "Apple",
                "Reed Flower", "Reed", "Flower", "Mushroom", "Fruit", "Vegetable", "Grain", "Seed"
            ],
            "Styx": [
                "Stone", "Wood", "Stick", "Sticks", "Fiber", "Leather", "Fur", "Bone", "Clay", "Ice", "Water",
                "Coal", "Oxite", "Sulfur", "Silica", "Tree Sap", "Carbon Paste", "Salt",
                "Iron Ore", "Copper Ore", "Gold Ore", "Aluminum Ore", "Platinum Ore", "Titanium Ore", "Frozen Ore",
                "Exotics", "Exotic Matter", "Caveworm Chitin",
                "Iron Ingot", "Steel Ingot", "Steel Bloom", "Aluminum Ingot", "Copper Ingot", 
                "Platinum Ingot", "Titanium Ingot", "Refined Gold", "Steel Screw", "Copper Wire",
                "Gold Wire", "Electronics", "Carbon Fiber", "Composites", "Epoxy", "Organic Resin",
                "Concrete Mix", "Glass", "Rope", "Wool", "Charcoal", "Biofuel Can", "Iron Nail", "Copper Nail",
                "Brown Bear Fur", "Brown Bear Leather", "Brown Bear Bone",
                "Wolf Fur", "Wolf Leather", "Wolf Bone",
                "Deer Fur", "Deer Leather", "Deer Bone",
                "Pumpkin", "Corn", "Wheat", "Carrot", "Potato", "Tomato", "Beans", "Berry", "Apple",
                "Reed Flower", "Reed", "Flower", "Mushroom", "Fruit", "Vegetable", "Grain", "Seed"
            ],
            "Prometheus": [
                "Stone", "Wood", "Stick", "Sticks", "Fiber", "Leather", "Fur", "Bone", "Clay", "Ice", "Water",
                "Coal", "Oxite", "Sulfur", "Silica", "Tree Sap", "Carbon Paste", "Salt",
                "Iron Ore", "Copper Ore", "Gold Ore", "Aluminum Ore", "Platinum Ore", "Titanium Ore",
                "Exotics", "Exotic Matter", "Obsidian", "Shaped Obsidian", "Caveworm Chitin",
                "Iron Ingot", "Steel Ingot", "Steel Bloom", "Aluminum Ingot", "Copper Ingot", 
                "Platinum Ingot", "Titanium Ingot", "Refined Gold", "Steel Screw", "Copper Wire",
                "Gold Wire", "Electronics", "Carbon Fiber", "Composites", "Epoxy", "Organic Resin",
                "Concrete Mix", "Glass", "Rope", "Wool", "Charcoal", "Biofuel Can", "Iron Nail", "Copper Nail",
                "Brown Bear Fur", "Brown Bear Leather", "Brown Bear Bone",
                "Wolf Fur", "Wolf Leather", "Wolf Bone",
                "Deer Fur", "Deer Leather", "Deer Bone",
                "Pumpkin", "Corn", "Wheat", "Carrot", "Potato", "Tomato", "Beans", "Berry", "Apple",
                "Reed Flower", "Reed", "Flower", "Mushroom", "Fruit", "Vegetable", "Grain", "Seed"
            ]
        };

        function ItemCard({ item, recipe, isSelected, isAvailable, onClick, onQuantityChange, currentQuantity }) {
            const getTierColor = (tier) => {
                switch(tier) {
                    case 0: return "#888";
                    case 1: return "#4ecdc4";
                    case 2: return "#45b7d1";
                    case 3: return "#f39c12";
                    case 4: return "#e74c3c";
                    default: return "#4ecdc4";
                }
            };

            const getIcon = (category) => {
                switch(category) {
                    case "Tools": return "ðŸ”§";
                    case "Weapons": return "âš”ï¸";
                    case "Armor": return "ðŸ›¡ï¸";
                    case "Deployables": return "ðŸ­";
                    case "Specialized Equipment": return "âš™ï¸";
                    case "Building": return "ðŸ—ï¸";
                    case "Cooking": return "ðŸ³";
                    case "Storage": return "ðŸ“¦";
                    case "Furniture": return "ðŸª‘";
                    case "Materials": return "ðŸ”©";
                    case "Raw Materials": return "â›ï¸";
                    case "Water Sources": return "ðŸ’§";
                    case "Electricity Sources": return "âš¡";
                    case "Fuel Sources": return "â›½";
                    case "Light Sources": return "ðŸ’¡";
                    case "Farming": return "ðŸŒ±";
                    case "Consumables": return "ðŸ§ª";
                    case "Medicine": return "ðŸ’Š";
                    case "Ammunition": return "ðŸ¹";
                    case "Inventory": return "ðŸŽ’";
                    case "Decoration": return "ðŸŽ¨";
                    default: return "ðŸ“‹";
                }
            };

            return React.createElement('div', {
                className: `item-card ${isSelected ? 'selected' : ''} ${!isAvailable ? 'unavailable' : ''}`,
                'data-item': item
            }, [
                React.createElement('div', { className: 'item-header', key: 'header' }, [
                    React.createElement('div', { key: 'info' }, [
                        React.createElement('div', { className: 'item-name', key: 'name' }, 
                            `${getIcon(recipe.category)} ${item}`
                        ),
                        React.createElement('div', { className: 'item-category', key: 'category' }, 
                            recipe.category
                        )
                    ]),
                    React.createElement('div', { className: 'availability-indicator', key: 'availability' }, 
                        isAvailable ? "âœ…" : "âŒ"
                    )
                ]),
                React.createElement('div', { className: 'item-details', key: 'details' }, [
                    React.createElement('span', { 
                        className: 'tier-badge', 
                        key: 'tier',
                        style: { background: getTierColor(recipe.tier) }
                    }, `T${recipe.tier}`),
                    React.createElement('span', { className: 'crafted-location', key: 'location' }, 
                        recipe.crafted_at
                    )
                ]),
                React.createElement('div', { 
                    className: 'quantity-controls', 
                    key: 'quantity-controls',
                    style: {
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        marginTop: '10px',
                        padding: '8px',
                        background: 'rgba(255,255,255,0.05)',
                        borderRadius: '8px'
                    }
                }, [
                    React.createElement('button', {
                        key: 'decrease',
                        onClick: (e) => {
                            e.stopPropagation();
                            if (currentQuantity > 0) {
                                onQuantityChange(item, currentQuantity - 1);
                            }
                        },
                        style: {
                            background: '#ff6b6b',
                            color: 'white',
                            border: 'none',
                            borderRadius: '6px',
                            width: '24px',
                            height: '24px',
                            cursor: 'pointer',
                            fontSize: '14px',
                            fontWeight: 'bold'
                        }
                    }, '-'),
                    React.createElement('span', {
                        key: 'quantity-display',
                        style: {
                            minWidth: '20px',
                            textAlign: 'center',
                            fontSize: '14px',
                            fontWeight: 'bold',
                            color: '#00d4ff'
                        }
                    }, currentQuantity || 0),
                    React.createElement('button', {
                        key: 'increase',
                        onClick: (e) => {
                            e.stopPropagation();
                            onQuantityChange(item, (currentQuantity || 0) + 1);
                        },
                        style: {
                            background: '#4ecdc4',
                            color: 'white',
                            border: 'none',
                            borderRadius: '6px',
                            width: '24px',
                            height: '24px',
                            cursor: 'pointer',
                            fontSize: '14px',
                            fontWeight: 'bold'
                        }
                    }, '+'),
                    React.createElement('button', {
                        key: 'add-to-cart',
                        onClick: (e) => {
                            e.stopPropagation();
                            if (currentQuantity > 0) {
                                onClick(item);
                            }
                        },
                        disabled: !currentQuantity || currentQuantity === 0,
                        style: {
                            background: currentQuantity > 0 ? '#00d4ff' : '#666',
                            color: 'white',
                            border: 'none',
                            borderRadius: '6px',
                            padding: '4px 8px',
                            cursor: currentQuantity > 0 ? 'pointer' : 'not-allowed',
                            fontSize: '11px',
                            fontWeight: 'bold',
                            marginLeft: '4px'
                        }
                    }, 'Add')
                ])
            ]);
        }

        function CartItem({ item, details, onRemove, recipes }) {
            return React.createElement('div', { className: 'cart-item', 'data-item': item }, [
                React.createElement('div', { className: 'cart-item-info', key: 'info' }, [
                    React.createElement('div', { className: 'cart-item-name', key: 'name' }, item),
                    React.createElement('div', { className: 'cart-item-details', key: 'details' }, 
                        `${recipes[item]?.crafted_at || "Unknown"} â€¢ T${recipes[item]?.tier || 0}`
                    )
                ]),
                React.createElement('div', { className: 'cart-item-quantity', key: 'quantity' }, `${details.quantity}x`),
                React.createElement('button', {
                    key: 'remove',
                    className: 'btn remove',
                    onClick: () => onRemove(item)
                }, "âœ•")
            ]);
        }

        function CraftingCalculator() {
            const [recipes, setRecipes] = useState({});
            const [loading, setLoading] = useState(true);
            const [loadingText, setLoadingText] = useState('Initializing calculator...');
            const [error, setError] = useState(null);
            const [activeTab, setActiveTab] = useState('calculator');
            const [currentMap, setCurrentMap] = useState('Olympus');
            const [searchTerm, setSearchTerm] = useState('');
            const [categoryFilter, setCategoryFilter] = useState('All');
            const [tierFilter, setTierFilter] = useState('All');
            const [shoppingCart, setShoppingCart] = useState({});
            const [results, setResults] = useState(null);
            const [checkedItems, setCheckedItems] = useState({});
            const [itemQuantities, setItemQuantities] = useState({});
            const [isCalculating, setIsCalculating] = useState(false);
            const resultsRef = useRef(null);
            const [activeTalents, setActiveTalents] = useState(new Set());
            const [showTalentPanel, setShowTalentPanel] = useState(false);

            // Crafting-related talents that affect recipes
            const CRAFTING_TALENTS = {
                "Ammunition: Munitions": {
                    description: "Craft ammunition at +50% output",
                    category: "Combat"
                },
                "Ammunition: Freebies": {
                    description: "5% chance to craft double ammunition",
                    category: "Combat"
                },
                "Pistol Proficiency": {
                    description: "Craft pistol ammo at -25% cost",
                    category: "Combat"
                },
                "Rifle Proficiency": {
                    description: "Craft rifle ammo at -25% cost",
                    category: "Combat"
                },
                "Shotgun Proficiency": {
                    description: "Craft shotgun ammo at -25% cost",
                    category: "Combat"
                }
            };

            // Load cart from localStorage on mount
            useEffect(() => {
                try {
                    const savedCart = localStorage.getItem('icarusCalculatorCart');
                    if (savedCart) {
                        const parsed = JSON.parse(savedCart);
                        setShoppingCart(parsed);
                        console.log('ðŸ“¦ Loaded cart from localStorage:', parsed);
                    }
                    
                    const savedTalents = localStorage.getItem('icarusCalculatorTalents');
                    if (savedTalents) {
                        const parsed = JSON.parse(savedTalents);
                        setActiveTalents(new Set(parsed));
                        console.log('ðŸŽ¯ Loaded talents from localStorage:', parsed);
                    }
                } catch (err) {
                    console.warn('Failed to load from localStorage:', err);
                }
            }, []);

            // Save cart to localStorage whenever it changes
            useEffect(() => {
                try {
                    if (Object.keys(shoppingCart).length > 0) {
                        localStorage.setItem('icarusCalculatorCart', JSON.stringify(shoppingCart));
                        console.log('ðŸ’¾ Saved cart to localStorage');
                    } else {
                        localStorage.removeItem('icarusCalculatorCart');
                    }
                } catch (err) {
                    console.warn('Failed to save cart to localStorage:', err);
                }
            }, [shoppingCart]);

            // Save talents to localStorage whenever they change
            useEffect(() => {
                try {
                    if (activeTalents.size > 0) {
                        localStorage.setItem('icarusCalculatorTalents', JSON.stringify(Array.from(activeTalents)));
                        console.log('ðŸ’¾ Saved talents to localStorage');
                    } else {
                        localStorage.removeItem('icarusCalculatorTalents');
                    }
                } catch (err) {
                    console.warn('Failed to save talents to localStorage:', err);
                }
            }, [activeTalents]);

            useEffect(() => {
                loadRecipes();
            }, []);

            // Scroll to results when they appear
            useEffect(() => {
                if (results && results.type === 'hierarchical' && resultsRef.current) {
                    setTimeout(() => {
                        resultsRef.current.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
            }, [results]);

            const loadRecipes = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    setLoadingText('Loading manifest...');
                    
                    const allRecipes = {};
                    let loadedCount = 0;
                    const errors = [];
                    
                    // Try different path variations
                    const pathVariations = [
                        'icarus_data/',
                        './icarus_data/',
                        '../icarus_data/',
                        '/icarus_data/'
                    ];
                    
                    let successfulPath = null;
                    let manifestData = null;
                    
                    // Cache-busting parameter to force fresh data
                    const cacheBuster = `?v=${Date.now()}`;
                    
                    // Try to load manifest.json to find the correct path
                    for (const basePath of pathVariations) {
                        try {
                            setLoadingText(`Checking for manifest at: ${basePath}...`);
                            const manifestResponse = await fetch(`${basePath}manifest.json${cacheBuster}`);
                            if (manifestResponse.ok) {
                                manifestData = await manifestResponse.json();
                                successfulPath = basePath;
                                setLoadingText(`âœ… Found manifest at: ${basePath}`);
                                console.log(`Success! Using path: ${basePath}`, manifestData);
                                break;
                            }
                        } catch (e) {
                            console.log(`Path ${basePath} failed:`, e.message);
                        }
                    }
                    
                    if (!successfulPath || !manifestData) {
                        throw new Error(`Cannot find manifest.json. 

Tried these paths:
${pathVariations.map(p => `- ${p}manifest.json`).join('\n')}

Please ensure:
1. The 'icarus_data' folder exists in the same directory as index.html
2. The 'icarus_data' folder contains manifest.json
3. You're serving via HTTP server (not file://)

Current location: ${window.location.href}
Protocol: ${window.location.protocol}`);
                    }
                    
                    // Get list of files from manifest
                    let filesToLoad = [];
                    if (manifestData.files && Array.isArray(manifestData.files)) {
                        filesToLoad = manifestData.files;
                    } else if (manifestData.recipes && Array.isArray(manifestData.recipes)) {
                        filesToLoad = manifestData.recipes;
                    } else if (Array.isArray(manifestData)) {
                        filesToLoad = manifestData;
                    } else {
                        // Fallback to hardcoded list
                        filesToLoad = JSON_FILES;
                    }
                    
                    console.log(`Loading ${filesToLoad.length} files from manifest:`, filesToLoad);
                    
                    // Load all JSON files using the successful path
                    for (const filename of filesToLoad) {
                        try {
                            setLoadingText(`ðŸ“¦ Loading ${filename}... (${loadedCount + 1}/${filesToLoad.length})`);
                            
                            const response = await fetch(`${successfulPath}${filename}${cacheBuster}`);
                            if (!response.ok) {
                                errors.push(`${filename}: HTTP ${response.status}`);
                                console.warn(`âš ï¸ Failed to load ${filename}: ${response.status}`);
                                continue;
                            }
                            
                            const data = await response.json();
                            
                            // Function to process a single item
                            const processItem = (item) => {
                                if (!item || !item.name) return;
                                
                                // Handle new format with multiple recipes
                                if (item.recipes && Array.isArray(item.recipes)) {
                                    allRecipes[item.name] = {
                                        recipes: item.recipes,
                                        crafted_at: item.crafted_at || 'Unknown',
                                        category: item.category || 'Unknown',
                                        tier: item.tier || 0,
                                        map_exclusive: item.map_exclusive || null
                                    };
                                    return;
                                }
                                
                                // Handle old format with single ingredients object
                                const ingredients = {};
                                if (item.ingredients && typeof item.ingredients === 'object') {
                                    Object.entries(item.ingredients).forEach(([key, value]) => {
                                        if (key !== 'Max' && typeof value === 'number') {
                                            ingredients[key] = value;
                                        }
                                    });
                                }
                                
                                allRecipes[item.name] = {
                                    ingredients: ingredients,
                                    output_quantity: item.output_quantity || 1,
                                    crafted_at: item.crafted_at || 'Unknown',
                                    category: item.category || 'Unknown',
                                    tier: item.tier || 0,
                                    map_exclusive: item.map_exclusive || null
                                };
                            };
                            
                            // Handle different JSON formats
                            if (data.items && Array.isArray(data.items)) {
                                // Format: { "items": [...] }
                                data.items.forEach(processItem);
                            } else if (data.name) {
                                // Format: Single item object { "name": "...", "ingredients": {...}, ... }
                                processItem(data);
                            } else if (Array.isArray(data)) {
                                // Format: Array of items [...]
                                data.forEach(processItem);
                            }
                            
                            console.log(`âœ… Loaded ${filename}`)
                            
                            loadedCount++;
                        } catch (fileError) {
                            errors.push(`${filename}: ${fileError.message}`);
                            console.warn(`âš ï¸ Error loading ${filename}:`, fileError);
                        }
                    }
                    
                    setLoadingText(`âœ… Processing ${Object.keys(allRecipes).length} recipes...`);
                    
                    const successfulFiles = loadedCount;
                    const totalFiles = filesToLoad.length;
                    
                    if (Object.keys(allRecipes).length === 0) {
                        throw new Error(`No recipes could be loaded. 

Files attempted: ${filesToLoad.length}
Successfully loaded: ${loadedCount}

Errors:
${errors.slice(0, 5).join('\n')}
${errors.length > 5 ? `\n...and ${errors.length - 5} more errors` : ''}

This indicates JSON files are missing or invalid.
Please check the 'icarus_data' folder exists and contains valid JSON files.`);
                    }
                    
                    // Success!
                    setRecipes(allRecipes);
                    setLoading(false);
                    
                    // Show a warning if some files are missing
                    if (successfulFiles < totalFiles) {
                        setTimeout(() => {
                            setResults({
                                type: 'success',
                                message: `âš ï¸ Loaded ${Object.keys(allRecipes).length} recipes from ${successfulFiles}/${totalFiles} files. Some files missing but calculator is functional!`
                            });
                            setTimeout(() => setResults(null), 5000);
                        }, 500);
                    }
                    
                    console.log(`ðŸŽ‰ Successfully loaded ${Object.keys(allRecipes).length} recipes from ${loadedCount}/${totalFiles} files`);
                    
                } catch (err) {
                    console.error('âŒ Error loading recipes:', err);
                    setError({
                        title: 'Failed to Load Recipe Database',
                        message: err.message,
                        details: err.stack
                    });
                    setLoading(false);
                }
            };

            const categories = [...new Set(Object.values(recipes).map(r => r.category))].sort();
            const tiers = [...new Set(Object.values(recipes).map(r => r.tier))].sort();

            const toggleTalent = (talent) => {
                setActiveTalents(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(talent)) {
                        newSet.delete(talent);
                    } else {
                        newSet.add(talent);
                    }
                    return newSet;
                });
            };

            const getBestRecipe = (item) => {
                const recipe = recipes[item];
                if (!recipe) return null;
                
                // If recipe has multiple recipes array, find best match
                if (recipe.recipes && Array.isArray(recipe.recipes)) {
                    // Find recipe with matching talent
                    for (const rec of recipe.recipes) {
                        if (rec.talent && activeTalents.has(rec.talent)) {
                            return rec;
                        }
                    }
                    // Return first recipe without talent requirement
                    const baseRecipe = recipe.recipes.find(r => !r.talent);
                    return baseRecipe || recipe.recipes[0];
                }
                
                // Old format - single recipe
                return {
                    ingredients: recipe.ingredients || {},
                    output_quantity: recipe.output_quantity || 1,
                    talent: null
                };
            };

            const toggleChecked = (itemKey) => {
                setCheckedItems(prev => ({
                    ...prev,
                    [itemKey]: !prev[itemKey]
                }));
            };

            const clearAllChecks = () => {
                setCheckedItems({});
            };

            const handleQuantityChange = (item, quantity) => {
                setItemQuantities(prev => ({
                    ...prev,
                    [item]: Math.max(0, quantity)
                }));
            };

            const getCompletionStats = () => {
                if (!results || results.type !== 'hierarchical') return null;
                
                const allItems = [];
                const addToList = (tree, prefix = '') => {
                    Object.entries(tree).forEach(([item, data]) => {
                        const key = `${prefix}${item}`;
                        allItems.push(key);
                        if (data.ingredients) {
                            Object.keys(data.ingredients).forEach(ingredient => {
                                const ingredientKey = `${key}-${ingredient}`;
                                allItems.push(ingredientKey);
                            });
                        }
                    });
                };
                
                addToList(results.craftingTree);
                Object.keys(results.rawMaterials).forEach(material => {
                    allItems.push(`raw-${material}`);
                });
                
                const completed = allItems.filter(item => checkedItems[item]).length;
                const total = allItems.length;
                
                return { completed, total, percentage: total > 0 ? Math.round((completed / total) * 100) : 0 };
            };

            const filteredItems = Object.entries(recipes).filter(([item, recipe]) => {
                const matchesSearch = item.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = categoryFilter === 'All' || recipe.category === categoryFilter;
                const matchesTier = tierFilter === 'All' || recipe.tier.toString() === tierFilter;
                return matchesSearch && matchesCategory && matchesTier;
            });

            const checkItemAvailability = (item, map, debugPath = []) => {
                const recipe = recipes[item];
                if (!recipe) {
                    return false;
                }
                
                if (debugPath.includes(item)) {
                    return false;
                }
                
                // Workshop and Orbital Exchange items are ALWAYS available on any map
                const purchasableLocations = [
                    'Workshop',
                    'Orbital Exchange',
                    'Space Station Workshop',
                    'Orbital Workshop',
                    'Workshop Purchased',
                    'Purchased'
                ];
                
                if (purchasableLocations.some(loc => 
                    recipe.crafted_at && recipe.crafted_at.toLowerCase().includes(loc.toLowerCase())
                )) {
                    return true;
                }
                
                if (recipe.map_exclusive && recipe.map_exclusive !== map) {
                    return false;
                }
                
                // Get the best recipe based on active talents
                const bestRecipe = getBestRecipe(item);
                if (!bestRecipe) return false;
                
                const requiredMaterials = Object.keys(bestRecipe.ingredients || {});
                
                if (requiredMaterials.length === 0) {
                    const isAvailable = MAP_RESOURCES[map]?.includes(item) || 
                           recipe.crafted_at === 'Character' ||
                           recipe.crafted_at === 'Character Crafting' ||
                           recipe.category === 'Raw Materials' ||
                           recipe.category === 'Consumables' ||
                           recipe.tier <= 1;
                    
                    return isAvailable;
                }
                
                for (const material of requiredMaterials) {
                    const alwaysAvailableMaterials = [
                        'Fiber', 'Wood', 'Stone', 'Stick', 'Sticks', 'Leather', 'Fur', 'Bone', 'Clay', 'Wool',
                        'Iron Ore', 'Copper Ore', 'Coal', 'Gold Ore', 'Aluminum Ore', 'Platinum Ore', 'Titanium Ore',
                        'Iron Ingot', 'Steel Ingot', 'Copper Ingot', 'Steel Bloom', 'Oxite', 'Sulfur', 'Tree Sap', 'Cold Steel Ingot',
                        'Brown Bear Leather', 'Brown Bear Fur', 'Brown Bear Bone',
                        'Wolf Leather', 'Wolf Fur', 'Wolf Bone',
                        'Deer Leather', 'Deer Fur', 'Deer Bone',
                        'Rope', 'Glass', 'Charcoal', 'Carbon Paste', 'Iron Nail', 'Copper Nail', 'Steel Screw',
                        'Water', 'Ice', 'Salt',
                        'Pumpkin', 'Corn', 'Wheat', 'Carrot', 'Potato', 'Tomato', 'Beans', 'Berry', 'Apple',
                        'Reed Flower', 'Reed', 'Flower', 'Mushroom', 'Fruit', 'Vegetable', 'Grain', 'Seed',
                        'Nail', 'Screw', 'Wire', 'Paste', 'Mix', 'Bloom', 'Bar', 'Ingot',
                        'Thatch', 'Plank', 'Board', 'Beam'
                    ];
                    
                    // Normalize material name for comparison (remove hyphens, extra spaces, etc.)
                    const normalizeName = (name) => {
                        return name.toLowerCase()
                            .replace(/-/g, ' ')
                            .replace(/\s+/g, ' ')
                            .trim();
                    };
                    
                    const normalizedMaterial = normalizeName(material);
                    
                    const materialVariations = [
                        material,
                        material.replace(/s$/, ''),
                        material + 's',
                        material.replace('Sticks', 'Stick'),
                        material.replace('Stick', 'Sticks'),
                        material.replace(/-/g, ' '),
                        material.replace(/ /g, '-'),
                        material.replace(/-/g, '')
                    ];
                    
                    const isBasicMaterial = materialVariations.some(variation => {
                        const normalizedVariation = normalizeName(variation);
                        return alwaysAvailableMaterials.some(avail => 
                            normalizeName(avail) === normalizedVariation
                        ) || MAP_RESOURCES[map]?.some(resource => 
                            normalizeName(resource) === normalizedVariation
                        );
                    });
                    
                    if (isBasicMaterial) {
                        continue;
                    }
                    
                    // Also check if this material exists as a craftable item
                    const materialRecipe = recipes[material];
                    if (!materialRecipe) {
                        // Material doesn't exist in recipes, check variations
                        const foundVariation = materialVariations.find(v => recipes[v]);
                        if (foundVariation) {
                            // Found a matching variation, check its availability
                            const materialAvailable = checkItemAvailability(foundVariation, map, [...debugPath, item]);
                            if (!materialAvailable) {
                                return false;
                            }
                        } else {
                            // Material not found anywhere - might be a typo in the JSON
                            console.warn(`âš ï¸ Material "${material}" not found for item "${item}"`);
                            return false;
                        }
                    } else {
                        const materialAvailable = checkItemAvailability(material, map, [...debugPath, item]);
                        
                        if (!materialAvailable) {
                            return false;
                        }
                    }
                }
                
                return true;
            };

            const addToCart = (item) => {
                const quantity = itemQuantities[item] || 1;
                setShoppingCart(prev => ({
                    ...prev,
                    [item]: {
                        quantity: (prev[item]?.quantity || 0) + quantity
                    }
                }));
                
                setItemQuantities(prev => ({
                    ...prev,
                    [item]: 0
                }));
                
                setResults({ type: 'success', message: `${quantity}x ${item} added to cart!` });
                setTimeout(() => setResults(null), 2000);
            };

            const removeFromCart = (item) => {
                setShoppingCart(prev => {
                    const newCart = { ...prev };
                    delete newCart[item];
                    return newCart;
                });
            };

            const clearCart = () => {
                setShoppingCart({});
                setCheckedItems({});
                setItemQuantities({});
                setResults({ type: 'success', message: 'Cart cleared!' });
                setTimeout(() => setResults(null), 2000);
            };

            const calculateRequirements = () => {
                if (Object.keys(shoppingCart).length === 0) {
                    setResults({ type: 'error', message: 'Cart is empty!' });
                    setTimeout(() => setResults(null), 3000);
                    return;
                }

                // Don't clear results - just calculate and update
                setIsCalculating(true);
                
                // Small delay to ensure state updates, then calculate
                requestAnimationFrame(() => {
                    const craftingTree = {};
                    const rawMaterials = {};
                    
                    const buildCraftingTree = (item, quantity, path = []) => {
                        const recipe = recipes[item];
                        if (!recipe) return;
                        
                        if (path.includes(item)) return;
                        
                        // Get the best recipe for this item
                        const bestRecipe = getBestRecipe(item);
                        if (!bestRecipe) return;
                        
                        if (Object.keys(bestRecipe.ingredients).length === 0) {
                            rawMaterials[item] = (rawMaterials[item] || 0) + quantity;
                            return;
                        }
                        
                        if (!craftingTree[item]) {
                            craftingTree[item] = {
                                totalNeeded: 0,
                                craftedAt: recipe.crafted_at,
                                tier: recipe.tier,
                                category: recipe.category,
                                ingredients: {},
                                usedTalent: bestRecipe.talent || null,
                                outputQuantity: bestRecipe.output_quantity || 1
                            };
                        }
                        
                        craftingTree[item].totalNeeded += quantity;
                        
                        Object.entries(bestRecipe.ingredients).forEach(([material, amount]) => {
                            const totalAmount = amount * quantity;
                            
                            if (!craftingTree[item].ingredients[material]) {
                                craftingTree[item].ingredients[material] = 0;
                            }
                            craftingTree[item].ingredients[material] += totalAmount;
                            
                            buildCraftingTree(material, totalAmount, [...path, item]);
                        });
                    };

                    Object.entries(shoppingCart).forEach(([item, details]) => {
                        buildCraftingTree(item, details.quantity);
                    });

                    // Set results and mark calculation complete
                    setResults({
                        type: 'hierarchical',
                        craftingTree,
                        rawMaterials,
                        cartItems: shoppingCart
                    });
                    
                    setIsCalculating(false);
                });
            };

            if (loading) {
                return React.createElement('div', { className: 'app-container' }, [
                    React.createElement('div', { className: 'app-header', key: 'header' }, [
                        React.createElement('h1', { className: 'app-title', key: 'title' }, "ðŸš€ ICARUS COMPLETE"),
                        React.createElement('p', { className: 'app-subtitle', key: 'subtitle' }, "Advanced Crafting Calculator with Complete Game Database")
                    ]),
                    React.createElement('div', { className: 'loading-screen', key: 'loading' }, [
                        React.createElement('div', { className: 'loading-spinner', key: 'spinner' }),
                        React.createElement('div', { className: 'loading-text', key: 'text' }, 'ðŸš€ Loading ICARUS Complete...'),
                        React.createElement('div', { className: 'loading-details', key: 'details' }, loadingText)
                    ])
                ]);
            }

            if (error) {
                return React.createElement('div', { className: 'app-container' }, [
                    React.createElement('div', { className: 'app-header', key: 'header' }, [
                        React.createElement('h1', { className: 'app-title', key: 'title' }, "ðŸš€ ICARUS COMPLETE"),
                        React.createElement('p', { className: 'app-subtitle', key: 'subtitle' }, "Advanced Crafting Calculator")
                    ]),
                    React.createElement('div', { className: 'error-screen', key: 'error' }, [
                        React.createElement('div', { className: 'error-title', key: 'title' }, `âŒ ${error.title}`),
                        React.createElement('pre', { 
                            key: 'message',
                            style: { 
                                fontSize: '0.9rem', 
                                color: '#ff6b6b', 
                                marginBottom: '20px',
                                whiteSpace: 'pre-wrap',
                                textAlign: 'left',
                                fontFamily: 'monospace'
                            } 
                        }, error.message),
                        React.createElement('button', {
                            key: 'retry',
                            className: 'retry-button',
                            onClick: loadRecipes
                        }, 'ðŸ”„ Retry Loading')
                    ])
                ]);
            }

            const renderTabContent = () => {
                switch (activeTab) {
                    case 'calculator':
                        return React.createElement('div', { key: 'calculator-content' }, [
                            React.createElement('div', { className: 'search-controls', key: 'controls' }, [
                                React.createElement('input', {
                                    key: 'search',
                                    type: 'text',
                                    placeholder: 'Search items...',
                                    className: 'search-input',
                                    value: searchTerm,
                                    onChange: (e) => setSearchTerm(e.target.value)
                                }),
                                React.createElement('select', {
                                    key: 'category',
                                    className: 'filter-select',
                                    value: categoryFilter,
                                    onChange: (e) => setCategoryFilter(e.target.value)
                                }, [
                                    React.createElement('option', { key: 'all', value: 'All' }, 'All Categories'),
                                    ...categories.map(cat => 
                                        React.createElement('option', { key: cat, value: cat }, cat)
                                    )
                                ]),
                                React.createElement('select', {
                                    key: 'tier',
                                    className: 'filter-select',
                                    value: tierFilter,
                                    onChange: (e) => setTierFilter(e.target.value)
                                }, [
                                    React.createElement('option', { key: 'all', value: 'All' }, 'All Tiers'),
                                    ...tiers.map(tier => 
                                        React.createElement('option', { key: tier, value: tier.toString() }, `Tier ${tier}`)
                                    )
                                ])
                            ]),
                            React.createElement('div', { className: 'map-selector', key: 'map-selector' }, [
                                React.createElement('span', { className: 'map-label', key: 'label' }, 'Map:'),
                                ...Object.keys(MAP_RESOURCES).map(map =>
                                    React.createElement('button', {
                                        key: map,
                                        className: `map-btn ${currentMap === map ? 'active' : ''}`,
                                        onClick: () => setCurrentMap(map)
                                    }, map)
                                )
                            ]),
                            React.createElement('div', { className: 'items-grid', key: 'items' },
                                filteredItems.map(([item, recipe]) =>
                                    React.createElement(ItemCard, {
                                        key: item,
                                        item,
                                        recipe,
                                        isSelected: !!shoppingCart[item],
                                        isAvailable: checkItemAvailability(item, currentMap),
                                        onClick: addToCart,
                                        onQuantityChange: handleQuantityChange,
                                        currentQuantity: itemQuantities[item] || 0
                                    })
                                )
                            ),
                            results && renderResults()
                        ]);

                    case 'talents':
                        return React.createElement('div', { className: 'map-info', key: 'talents-content' }, [
                            React.createElement('h3', { key: 'title' }, 'ðŸŽ¯ Active Talents'),
                            React.createElement('p', { key: 'desc' }, 
                                `Select talents to optimize recipe calculations. Talents affect ingredient costs and output quantities. ${activeTalents.size} active.`
                            ),
                            React.createElement('div', { 
                                key: 'talents-grid',
                                style: {
                                    display: 'grid',
                                    gridTemplateColumns: '1fr',
                                    gap: '10px',
                                    marginTop: '20px'
                                }
                            }, Object.entries(CRAFTING_TALENTS).map(([talent, info]) =>
                                React.createElement('div', {
                                    key: talent,
                                    onClick: () => toggleTalent(talent),
                                    style: {
                                        padding: '12px',
                                        background: activeTalents.has(talent) ? 'rgba(0, 212, 255, 0.2)' : 'rgba(255,255,255,0.05)',
                                        border: `1px solid ${activeTalents.has(talent) ? '#00d4ff' : 'rgba(255,255,255,0.1)'}`,
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        transition: 'all 0.3s ease'
                                    }
                                }, [
                                    React.createElement('div', {
                                        key: 'header',
                                        style: { display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '5px' }
                                    }, [
                                        React.createElement('input', {
                                            key: 'checkbox',
                                            type: 'checkbox',
                                            checked: activeTalents.has(talent),
                                            onChange: () => {},
                                            style: { width: '18px', height: '18px', accentColor: '#00d4ff' }
                                        }),
                                        React.createElement('span', {
                                            key: 'name',
                                            style: { fontWeight: '600', fontSize: '14px' }
                                        }, talent)
                                    ]),
                                    React.createElement('div', {
                                        key: 'info',
                                        style: { fontSize: '12px', color: '#b0b3b8', marginLeft: '28px' }
                                    }, `${info.category} â€¢ ${info.description}`)
                                ])
                            ))
                        ]);

                    case 'map':
                        return React.createElement('div', { className: 'map-info', key: 'map-info' }, [
                            React.createElement('h3', { key: 'title' }, `ðŸ—ºï¸ ${currentMap} Resources`),
                            React.createElement('p', { key: 'description' }, 
                                currentMap === 'Olympus' ? "The starter map with Forest, Arctic, and Desert biomes. ALL ORES available in caves including Platinum and Titanium!" :
                                currentMap === 'Prometheus' ? "ðŸŒ‹ Volcanic DLC map with unique Obsidian deposits. Biome-specific ore distribution in caves." :
                                currentMap === 'Styx' ? "ðŸ’Ž Advanced DLC map with all standard ores available. Same ore distribution as Olympus." : ""
                            ),
                            React.createElement('div', { className: 'resource-grid', key: 'resources' },
                                MAP_RESOURCES[currentMap]?.map(resource =>
                                    React.createElement('div', {
                                        key: resource,
                                        className: 'resource-badge'
                                    }, resource)
                                )
                            )
                        ]);

                    default:
                        return null;
                }
            };

            const renderResults = () => {
                if (!results) return null;
                
                switch (results.type) {
                    case 'success':
                        return React.createElement('div', { className: 'success-banner' }, `âœ… ${results.message}`);
                    
                    case 'hierarchical':
                        const renderCraftingStep = (item, data, depth = 0, parentKey = '') => {
                            const recipe = recipes[item];
                            const isAvailable = checkItemAvailability(item, currentMap);
                            const indent = depth * 20;
                            const itemKey = parentKey ? `${parentKey}-${item}` : item;
                            const isChecked = checkedItems[itemKey];
                            
                            return React.createElement('div', {
                                key: `${item}-${depth}`,
                                style: {
                                    marginLeft: `${indent}px`,
                                    marginBottom: '8px',
                                    padding: '8px',
                                    background: depth === 0 ? 'rgba(0, 212, 255, 0.1)' : 
                                               depth === 1 ? 'rgba(255, 255, 255, 0.05)' : 
                                               'rgba(255, 255, 255, 0.02)',
                                    border: `1px solid ${depth === 0 ? 'rgba(0, 212, 255, 0.3)' : 'rgba(255, 255, 255, 0.1)'}`,
                                    borderRadius: '6px',
                                    borderLeft: `4px solid ${getTierColor(recipe?.tier || 0)}`,
                                    opacity: isChecked ? 0.6 : 1,
                                    transition: 'opacity 0.3s ease'
                                }
                            }, [
                                React.createElement('div', {
                                    key: 'header',
                                    style: {
                                        display: 'flex',
                                        justifyContent: 'space-between',
                                        alignItems: 'center',
                                        marginBottom: Object.keys(data.ingredients || {}).length > 0 ? '8px' : '0'
                                    }
                                }, [
                                    React.createElement('div', {
                                        key: 'left-content',
                                        style: { display: 'flex', alignItems: 'center', gap: '8px' }
                                    }, [
                                        React.createElement('input', {
                                            key: 'checkbox',
                                            type: 'checkbox',
                                            checked: isChecked || false,
                                            onChange: () => toggleChecked(itemKey),
                                            style: {
                                                width: '16px',
                                                height: '16px',
                                                cursor: 'pointer',
                                                accentColor: '#00d4ff'
                                            }
                                        }),
                                        React.createElement('span', {
                                            key: 'name',
                                            style: {
                                                fontWeight: depth === 0 ? '700' : '600',
                                                color: isAvailable ? '#ffffff' : '#ff6b6b',
                                                fontSize: depth === 0 ? '14px' : '13px',
                                                textDecoration: isChecked ? 'line-through' : 'none'
                                            }
                                        }, `${isAvailable ? 'âœ…' : 'âŒ'} ${data.totalNeeded}x ${item}`)
                                    ]),
                                    React.createElement('span', {
                                        key: 'info',
                                        style: {
                                            fontSize: '11px',
                                            color: '#b0b3b8'
                                        }
                                    }, [
                                        `${recipe?.crafted_at || 'Raw'} â€¢ T${recipe?.tier || 0}`,
                                        data.usedTalent && React.createElement('span', {
                                            key: 'talent',
                                            style: {
                                                marginLeft: '5px',
                                                color: '#4ecdc4',
                                                fontWeight: '600'
                                            }
                                        }, ` â€¢ ðŸŽ¯ ${data.usedTalent}`)
                                    ])
                                ]),
                                Object.keys(data.ingredients || {}).length > 0 && React.createElement('div', {
                                    key: 'ingredients',
                                    style: { marginLeft: '10px' }
                                }, Object.entries(data.ingredients).map(([ingredient, amount]) => {
                                    const ingredientData = results.craftingTree[ingredient];
                                    if (ingredientData) {
                                        return renderCraftingStep(ingredient, ingredientData, depth + 1, itemKey);
                                    } else {
                                        const isRawAvailable = MAP_RESOURCES[currentMap]?.includes(ingredient);
                                        const rawKey = `${itemKey}-${ingredient}`;
                                        const isRawChecked = checkedItems[rawKey];
                                        
                                        return React.createElement('div', {
                                            key: ingredient,
                                            style: {
                                                marginLeft: `${(depth + 1) * 20}px`,
                                                marginBottom: '4px',
                                                padding: '4px 8px',
                                                background: 'rgba(255, 255, 255, 0.02)',
                                                border: '1px solid rgba(255, 255, 255, 0.05)',
                                                borderRadius: '4px',
                                                fontSize: '12px',
                                                color: isRawAvailable ? '#ffffff' : '#ff6b6b',
                                                borderLeft: '3px solid #888',
                                                opacity: isRawChecked ? 0.6 : 1,
                                                transition: 'opacity 0.3s ease',
                                                display: 'flex',
                                                alignItems: 'center',
                                                gap: '8px'
                                            }
                                        }, [
                                            React.createElement('input', {
                                                key: 'raw-checkbox',
                                                type: 'checkbox',
                                                checked: isRawChecked || false,
                                                onChange: () => toggleChecked(rawKey),
                                                style: {
                                                    width: '14px',
                                                    height: '14px',
                                                    cursor: 'pointer',
                                                    accentColor: '#00d4ff'
                                                }
                                            }),
                                            React.createElement('span', {
                                                key: 'raw-text',
                                                style: {
                                                    textDecoration: isRawChecked ? 'line-through' : 'none'
                                                }
                                            }, `${isRawAvailable ? 'âœ…' : 'âŒ'} ${amount}x ${ingredient} (Raw Material)`)
                                        ]);
                                    }
                                }))
                            ]);
                        };

                        const getTierColor = (tier) => {
                            switch(tier) {
                                case 0: return "#888";
                                case 1: return "#4ecdc4";
                                case 2: return "#45b7d1";
                                case 3: return "#f39c12";
                                case 4: return "#e74c3c";
                                default: return "#4ecdc4";
                            }
                        };

                        const unavailableRawMaterials = Object.keys(results.rawMaterials).filter(material => 
                            !MAP_RESOURCES[currentMap]?.includes(material)
                        );

                        const completionStats = getCompletionStats();
                        
                        return React.createElement('div', { 
                            className: 'results-panel',
                            ref: resultsRef 
                        }, [
                            React.createElement('div', { 
                                className: 'results-title', 
                                key: 'title',
                                style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center' }
                            }, [
                                React.createElement('span', { key: 'title-text' }, 'ðŸ§® Complete Crafting Breakdown'),
                                React.createElement('div', { 
                                    key: 'progress-controls',
                                    style: { display: 'flex', alignItems: 'center', gap: '10px' }
                                }, [
                                    completionStats && React.createElement('span', {
                                        key: 'progress',
                                        style: {
                                            fontSize: '12px',
                                            color: completionStats.percentage === 100 ? '#4ecdc4' : '#b0b3b8',
                                            fontWeight: '600'
                                        }
                                    }, `${completionStats.completed}/${completionStats.total} (${completionStats.percentage}%)`),
                                    React.createElement('button', {
                                        key: 'clear-checks',
                                        onClick: clearAllChecks,
                                        style: {
                                            background: 'rgba(255, 107, 107, 0.2)',
                                            color: '#ff6b6b',
                                            border: '1px solid rgba(255, 107, 107, 0.3)',
                                            borderRadius: '6px',
                                            padding: '4px 8px',
                                            fontSize: '11px',
                                            cursor: 'pointer',
                                            fontWeight: '600'
                                        }
                                    }, 'Clear All âœ•')
                                ])
                            ]),
                            
                            React.createElement('div', {
                                key: 'targets',
                                style: { marginBottom: '20px' }
                            }, [
                                React.createElement('h4', {
                                    key: 'targets-title',
                                    style: { 
                                        color: '#00d4ff', 
                                        fontSize: '14px', 
                                        marginBottom: '10px',
                                        fontWeight: '600'
                                    }
                                }, 'ðŸŽ¯ Target Items:'),
                                ...Object.entries(results.cartItems).map(([item, details]) => {
                                    const craftingData = results.craftingTree[item];
                                    if (craftingData) {
                                        return renderCraftingStep(item, craftingData, 0);
                                    }
                                    return null;
                                }).filter(Boolean)
                            ]),

                            React.createElement('div', {
                                key: 'raw-summary'
                            }, [
                                React.createElement('h4', {
                                    key: 'raw-title',
                                    style: { 
                                        color: '#00d4ff', 
                                        fontSize: '14px', 
                                        marginBottom: '10px',
                                        fontWeight: '600'
                                    }
                                }, 'â›ï¸ Total Raw Materials Summary:'),
                                ...Object.entries(results.rawMaterials).map(([material, amount]) => {
                                    const isAvailable = MAP_RESOURCES[currentMap]?.includes(material);
                                    const rawKey = `raw-${material}`;
                                    const isRawChecked = checkedItems[rawKey];
                                    
                                    return React.createElement('div', { 
                                        key: material, 
                                        className: 'resource-item',
                                        style: { 
                                            opacity: isRawChecked ? 0.6 : (isAvailable ? 1 : 0.6),
                                            transition: 'opacity 0.3s ease',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '8px'
                                        }
                                    }, [
                                        React.createElement('input', {
                                            key: 'summary-checkbox',
                                            type: 'checkbox',
                                            checked: isRawChecked || false,
                                            onChange: () => toggleChecked(rawKey),
                                            style: {
                                                width: '16px',
                                                height: '16px',
                                                cursor: 'pointer',
                                                accentColor: '#00d4ff'
                                            }
                                        }),
                                        React.createElement('span', { 
                                            className: 'resource-name', 
                                            key: 'name',
                                            style: {
                                                textDecoration: isRawChecked ? 'line-through' : 'none'
                                            }
                                        }, `${isAvailable ? 'âœ…' : 'âŒ'} ${material}`),
                                        React.createElement('span', { 
                                            className: 'resource-amount', 
                                            key: 'amount',
                                            style: {
                                                textDecoration: isRawChecked ? 'line-through' : 'none'
                                            }
                                        }, `${amount}x`)
                                    ])
                                })
                            ]),

                            unavailableRawMaterials.length > 0 && React.createElement('div', {
                                key: 'warning',
                                style: {
                                    marginTop: '15px',
                                    padding: '10px',
                                    background: 'rgba(255, 107, 107, 0.1)',
                                    border: '1px solid rgba(255, 107, 107, 0.3)',
                                    borderRadius: '8px',
                                    fontSize: '12px',
                                    color: '#ff6b6b'
                                }
                            }, `âš ï¸ ${unavailableRawMaterials.length} raw materials not available on ${currentMap}`)
                        ]);

                    case 'error':
                        return React.createElement('div', { 
                            style: { 
                                background: 'rgba(255, 107, 107, 0.2)', 
                                color: '#ff6b6b', 
                                padding: '15px', 
                                borderRadius: '10px', 
                                marginTop: '15px',
                                textAlign: 'center',
                                fontWeight: '600'
                            } 
                        }, `âŒ ${results.message}`);
                    
                    default:
                        return null;
                }
            };

            const availableCount = filteredItems.filter(([item]) => checkItemAvailability(item, currentMap)).length;
            const totalCount = filteredItems.length;
            const totalItems = Object.keys(recipes).length;

            return React.createElement('div', { className: 'app-container' }, [
                React.createElement('div', { className: 'app-header', key: 'header' }, [
                    React.createElement('h1', { className: 'app-title', key: 'title' }, "ðŸš€ ICARUS COMPLETE"),
                    React.createElement('p', { className: 'app-subtitle', key: 'subtitle' }, "Advanced Crafting Calculator with Complete Game Database â€¢ JSON-Powered â€¢ Live Data"),
                    React.createElement('div', { className: 'stats-header', key: 'stats' }, 
                        `ðŸ“Š Database: ${totalItems} Total Items â€¢ ${availableCount}/${totalCount} Available on ${currentMap}`
                    )
                ]),

                React.createElement('div', { className: 'main-content', key: 'main' }, [
                    React.createElement('div', { className: 'content-panel', key: 'content' }, [
                        React.createElement('div', { className: 'tab-nav', key: 'nav' }, [
                            React.createElement('button', {
                                key: 'calc-tab',
                                className: `tab-button ${activeTab === 'calculator' ? 'active' : ''}`,
                                onClick: () => setActiveTab('calculator')
                            }, "ðŸ”¨ Calculator"),
                            React.createElement('button', {
                                key: 'talents-tab',
                                className: `tab-button ${activeTab === 'talents' ? 'active' : ''}`,
                                onClick: () => setActiveTab('talents')
                            }, `ðŸŽ¯ Talents ${activeTalents.size > 0 ? `(${activeTalents.size})` : ''}`),
                            React.createElement('button', {
                                key: 'map-tab',
                                className: `tab-button ${activeTab === 'map' ? 'active' : ''}`,
                                onClick: () => setActiveTab('map')
                            }, "ðŸ—ºï¸ Map Info")
                        ]),

                        React.createElement('div', { className: 'tab-content', key: 'tab-content' }, 
                            renderTabContent()
                        )
                    ]),

                    React.createElement('div', { className: 'shopping-cart', key: 'cart' }, [
                        React.createElement('div', { className: 'cart-header', key: 'cart-header' }, [
                            React.createElement('h3', { className: 'cart-title', key: 'title' }, "ðŸ›’ Shopping Cart"),
                            React.createElement('span', { className: 'cart-count', key: 'count' }, Object.keys(shoppingCart).length)
                        ]),

                        React.createElement('div', { className: 'cart-items', key: 'cart-items' },
                            Object.keys(shoppingCart).length === 0 ? 
                                React.createElement('div', { className: 'cart-empty' }, "Add items to your cart to get started!") :
                                Object.entries(shoppingCart).map(([item, details]) =>
                                    React.createElement(CartItem, {
                                        key: item,
                                        item,
                                        details,
                                        onRemove: removeFromCart,
                                        recipes: recipes
                                    })
                                )
                        ),

                        React.createElement('div', { className: 'action-buttons', key: 'actions' }, [
                            React.createElement('button', {
                                key: 'calculate',
                                className: 'btn primary',
                                onClick: calculateRequirements,
                                disabled: Object.keys(shoppingCart).length === 0 || isCalculating
                            }, isCalculating ? 'â³ Calculating...' : 'ðŸ§® Calculate'),
                            React.createElement('button', {
                                key: 'clear',
                                className: 'btn secondary',
                                onClick: clearCart,
                                disabled: Object.keys(shoppingCart).length === 0
                            }, "ðŸ—‘ï¸ Clear")
                        ]),

                        React.createElement('div', { 
                            className: 'stats-panel',
                            key: 'stats'
                        }, [
                            React.createElement('div', { key: 'available' }, `Available on ${currentMap}: ${availableCount}/${totalCount}`),
                            React.createElement('div', { key: 'total' }, `Total Database: ${totalItems} items`),
                            React.createElement('div', { key: 'cart' }, `Cart Items: ${Object.keys(shoppingCart).length}`)
                        ])
                    ])
                ])
            ]);
        }

        ReactDOM.render(React.createElement(CraftingCalculator), document.getElementById('root'));
    </script>
</body>
</html>